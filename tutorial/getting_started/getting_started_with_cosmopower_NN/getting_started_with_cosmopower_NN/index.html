
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://alessiospuriomancini.github.io/cosmopower/tutorial/getting_started/getting_started_with_cosmopower_NN/getting_started_with_cosmopower_NN/">
      
      <link rel="icon" href="../../../../static/favicon_logo.jpg">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.1">
    
    
      
        <title>NN emulation - CosmoPower</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.e8d9bf0c.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../static/global.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="CosmoPower" class="md-header__button md-logo" aria-label="CosmoPower" data-md-component="logo">
      
  <img src="../../../../static/favicon_logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CosmoPower
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              NN emulation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="http://github.com/alessiospuriomancini/cosmopower/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    alessiospuriomancini/cosmopower
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="CosmoPower" class="md-nav__button md-logo" aria-label="CosmoPower" data-md-component="logo">
      
  <img src="../../../../static/favicon_logo.jpg" alt="logo">

    </a>
    CosmoPower
  </label>
  
    <div class="md-nav__source">
      <a href="http://github.com/alessiospuriomancini/cosmopower/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    alessiospuriomancini/cosmopower
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Tutorials and Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials and Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials and Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        NN emulation
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started_with_cosmopower_PCAplusNN/getting_started_with_cosmopower_PCAplusNN/" class="md-nav__link">
        PCA+NN emulation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Training
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Training" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Training
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_1" type="checkbox" id="__nav_3_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_1">
          Data generation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data generation" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_1">
          <span class="md-nav__icon md-icon"></span>
          Data generation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../training/data_generation/create_params/" class="md-nav__link">
        Latin Hypercube Sampling the emulator parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../training/data_generation/create_spectra/" class="md-nav__link">
        Creating the spectra with a Boltzmann code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../training/data_generation/format/" class="md-nav__link">
        Preparing the data for training
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../training/NN/training_NN/" class="md-nav__link">
        NN training
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../training/PCAplusNN/training_PCAplusNN/" class="md-nav__link">
        PCA+NN training
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Likelihoods
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Likelihoods" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Likelihoods
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../likelihoods/tf_planck2018_lite/" class="md-nav__link">
        TensorFlow Planck-lite 2018 likelihood
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../contribute/" class="md-nav__link">
        Contribute/Support/Community
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Code Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../API/cosmopower_NN-reference/" class="md-nav__link">
        cosmopower_NN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../API/cosmopower_PCA-reference/" class="md-nav__link">
        cosmopower_PCA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../API/cosmopower_PCAplusNN-reference/" class="md-nav__link">
        cosmopower_PCAplusNN
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../citation/" class="md-nav__link">
        Citation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="http://github.com/alessiospuriomancini/cosmopower/edit/master/docs/tutorial/getting_started/getting_started_with_cosmopower_NN/getting_started_with_cosmopower_NN.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="introduction"><strong>INTRODUCTION</strong><a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<p>This notebook can also be run on Colab. <a href="https://colab.research.google.com/drive/1Fv70tJXCDnlTZYxMzr43q25PK5Kc3G7i?usp=sharing"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>In this notebook we will explore the main features of the emulators for cosmological power spectra implemented in the <code>CosmoPower</code> class <code>cosmopower_NN</code>. We will consider two examples: the first one is an emulator for CMB TT power spectra, the second one is an emulator of the linear matter power spectrum.</p>
<p><strong>Note 1</strong>: there is, in fact, no fundamental difference in the way <code>cosmopower_NN</code> works for CMB and <span class="arithmatex">\(P(k)\)</span> power spectra. Here we are explicitly showing both cases for completeness, but the internal workings of the emulator are the same and the way one obtains predictions from the emulator also does not change;</p>
<p><strong>Note 2</strong>: similarly, there is no fundamental difference between different types of CMB power spectra (TT,TE,EE,PP) or linear/non linear <span class="arithmatex">\(P(k)\)</span>. In this notebook we will consider examples involving CMB <em>TT</em> power spectra and <em>linear</em> matter power spectrum, but the same syntax can be used for all types of spectra emulated with <code>cosmopower_NN</code>.</p>
<h1 id="preliminary-operations"><strong>PRELIMINARY OPERATIONS</strong><a class="headerlink" href="#preliminary-operations" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">clear_output</span>
</code></pre></div>
<h1 id="cosmopower_nn-cmb-example"><strong><code>cosmopower_NN</code> - CMB example</strong><a class="headerlink" href="#cosmopower_nn-cmb-example" title="Permanent link">&para;</a></h1>
<p>A <code>cosmopower_NN</code> model is a direct mapping between cosmological parameters and (log)-power spectra. </p>
<p><img src='https://drive.google.com/uc?id=1ldao4kWmzsbIRoGAXXRu65UYDSC8bLqQ'></p>
<p>Let&rsquo;s consider a pre-trained model emulating Cosmic Microwave Background temperature (TT) power spectra. In the CosmoPower repository we can find an example of such a pre-trained model in the <a href="https://github.com/alessiospuriomancini/cosmopower/blob/main/cosmopower/trained_models">trained_models</a> folder (<a href="https://github.com/alessiospuriomancini/cosmopower/blob/main/cosmopower/trained_models/CP_paper/CMB/cmb_TT_NN.pkl">cmb_TT_NN.pkl</a>). </p>
<h2 id="loading-a-saved-model"><strong>Loading a saved model</strong><a class="headerlink" href="#loading-a-saved-model" title="Permanent link">&para;</a></h2>
<p>Loading a saved <code>cosmopower_NN</code> model is as simple as instantiating a <code>cosmopower_NN</code> instance with:</p>
<ul>
<li>
<p>the attribute <code>restore</code> set to <code>True</code> and</p>
</li>
<li>
<p>the attribute <code>restore_filename</code> pointing to the <code>.pkl</code> file where the model is saved (<em>without</em> the <code>.pkl</code> suffix).</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="n">ipynb_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s2">&quot;__file__&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">cosmopower</span> <span class="k">as</span> <span class="nn">cp</span>

<span class="c1"># load pre-trained NN model: maps cosmological parameters to CMB TT log-C_ell</span>
<span class="n">cp_nn</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">cosmopower_NN</span><span class="p">(</span><span class="n">restore</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                         <span class="n">restore_filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ipynb_path</span><span class="p">,</span> <span class="s1">&#39;../../cosmopower/trained_models/CP_paper/CMB/cmb_TT_NN&#39;</span><span class="p">))</span>
</code></pre></div>
<h2 id="exploring-the-model-features"><strong>Exploring the model features</strong><a class="headerlink" href="#exploring-the-model-features" title="Permanent link">&para;</a></h2>
<p>Now that the model is loaded, we can explore some its features. First, let&rsquo;s see what are the parameters that the emulator was trained on:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;emulator parameters: &#39;</span><span class="p">,</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>emulator parameters:  ListWrapper([&#39;omega_b&#39;, &#39;omega_cdm&#39;, &#39;h&#39;, &#39;tau_reio&#39;, &#39;n_s&#39;, &#39;ln10^{10}A_s&#39;])
</code></pre></div>

<p>Next, let&rsquo;s see how the emulator samples the <span class="arithmatex">\(\ell\)</span> multipoles for this CMB case:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampled multipoles: &#39;</span><span class="p">,</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;number of multipoles: &#39;</span><span class="p">,</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">n_modes</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>sampled multipoles:  [   2    3    4 ... 2506 2507 2508]
number of multipoles:  2507
</code></pre></div>

<p>The model is a direct neural network mapping 6 parameters into 2507 multipoles. Let&rsquo;s find out its internal architecture:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hidden layers: &#39;</span><span class="p">,</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>hidden layers:  ListWrapper([512, 512, 512, 512])
</code></pre></div>

<p>The model has 4 hidden layers, each with 512 nodes.</p>
<h2 id="obtaining-predictions"><strong>Obtaining predictions</strong><a class="headerlink" href="#obtaining-predictions" title="Permanent link">&para;</a></h2>
<p>Now let&rsquo;s explore how <code>cosmopower_NN</code> produces power spectra predictions for a given set of input parameters. All <code>CosmoPower</code> models take in input a Python <code>dict</code> of parameters, for example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># # create a dict of cosmological parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;omega_b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0225</span><span class="p">],</span>
          <span class="s1">&#39;omega_cdm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.113</span><span class="p">],</span>
          <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">],</span>
          <span class="s1">&#39;tau_reio&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.055</span><span class="p">],</span>
          <span class="s1">&#39;n_s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.96</span><span class="p">],</span>
          <span class="s1">&#39;ln10^</span><span class="si">{10}</span><span class="s1">A_s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.07</span><span class="p">],</span>
          <span class="p">}</span>
</code></pre></div>
<p>The reason for using input dictionaries is that the user does not need to be concerned with ordering the input parameters. </p>
<p>The loaded model is an emulator of <em>log</em>-power spectra. This was done to reduce the dynamic range of the training set, which helps considerably the emulator during training. Therefore, a forward pass of the input parameters on the trained network (with the method <code>predictions_np</code>) would result in a prediction for the log-power spectrum:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># predictions (= forward pass thorugh the network)</span>
<span class="n">log_spectrum_cosmopower_NN</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">predictions_np</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>
<p>Sometimes it is convenient to output log-spectra, e.g. for interpolation purposes. However, if the user is only interested in spectra, the conversion from log-spectra to spectra can also be done internally by <code>cosmopower_NN</code>, with the method <code>ten_to_predictions_np</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># predictions (= forward pass thorugh the network) -&gt; 10^predictions</span>
<span class="n">spectrum_cosmopower_NN</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">ten_to_predictions_np</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>
<h2 id="comparing-with-class"><strong>COMPARING WITH <code>CLASS</code></strong><a class="headerlink" href="#comparing-with-class" title="Permanent link">&para;</a></h2>
<p>Let&rsquo;s compare the prediction for the TT power spectrum from <code>CosmoPower</code> with that from the Boltzmann code <a href="https://arxiv.org/abs/1104.2933">Class</a>. We first need to clone the <a href="https://github.com/lesgourg/class_public">CLASS repository</a>, compile and install the code:</p>
<div class="highlight"><pre><span></span><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">cython</span>
<span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lesgourg</span><span class="o">/</span><span class="n">class_public</span>
<span class="o">%</span><span class="n">cd</span> <span class="n">class_public</span>
<span class="err">!</span><span class="n">make</span> <span class="n">clean</span>
<span class="err">!</span><span class="n">make</span>
<span class="o">%</span><span class="n">cd</span> <span class="n">python</span> 
<span class="err">!</span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span>
<span class="err">!</span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span> 
</code></pre></div>
<p>The call to <code>Class</code> to obtain the same power spectrum prediction obtained from <code>CosmoPower</code> is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">classy</span> <span class="kn">import</span> <span class="n">Class</span>

<span class="n">cosmo</span> <span class="o">=</span> <span class="n">Class</span><span class="p">()</span>

<span class="c1"># Define cosmology (what is not specified will be set to CLASS default parameters)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;tCl lCl&#39;</span><span class="p">,</span>
          <span class="s1">&#39;l_max_scalars&#39;</span><span class="p">:</span><span class="mi">2508</span><span class="p">,</span>
          <span class="s1">&#39;non linear&#39;</span><span class="p">:</span> <span class="s1">&#39;hmcode&#39;</span><span class="p">,</span>
          <span class="s1">&#39;nonlinear_min_k_max&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
          <span class="s1">&#39;lensing&#39;</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span>
          <span class="s1">&#39;N_ncdm&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s1">&#39;N_eff&#39;</span> <span class="p">:</span> <span class="mf">3.046</span><span class="p">,</span>
          <span class="s1">&#39;omega_b&#39;</span><span class="p">:</span> <span class="mf">0.0225</span><span class="p">,</span>
          <span class="s1">&#39;omega_cdm&#39;</span><span class="p">:</span> <span class="mf">0.113</span><span class="p">,</span>
          <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
          <span class="s1">&#39;tau_reio&#39;</span><span class="p">:</span> <span class="mf">0.055</span><span class="p">,</span>
          <span class="s1">&#39;n_s&#39;</span><span class="p">:</span> <span class="mf">0.96</span><span class="p">,</span>
          <span class="s1">&#39;ln10^</span><span class="si">{10}</span><span class="s1">A_s&#39;</span><span class="p">:</span> <span class="mf">3.07</span><span class="p">,</span>
          <span class="p">}</span>

<span class="n">cosmo</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">cosmo</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="bp">cls</span> <span class="o">=</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">lensed_cl</span><span class="p">(</span><span class="n">lmax</span><span class="o">=</span><span class="mi">2508</span><span class="p">)</span>
<span class="n">spectrum_class</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">[</span><span class="s1">&#39;tt&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">cosmo</span><span class="o">.</span><span class="n">struct_cleanup</span><span class="p">()</span>
<span class="n">cosmo</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>
</code></pre></div>
<p>Now let&rsquo;s plot a comparison between the <code>CosmoPower</code> and <code>Class</code> predictions:</p>
<div class="highlight"><pre><span></span><code><span class="n">ell_modes</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">modes</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">true</span> <span class="o">=</span> <span class="n">spectrum_class</span><span class="o">*</span><span class="n">ell_modes</span><span class="o">*</span><span class="p">(</span><span class="n">ell_modes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">spectrum_cosmopower_NN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ell_modes</span><span class="o">*</span><span class="p">(</span><span class="n">ell_modes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">ell_modes</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CLASS&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">ell_modes</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;COSMOPOWER NN&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\ell$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;30&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">frac{\ell(\ell+1)}{2 \pi} C_\ell$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;30&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../output_36_1.png" /></p>
<h2 id="batch-predictions"><strong>BATCH PREDICTIONS</strong><a class="headerlink" href="#batch-predictions" title="Permanent link">&para;</a></h2>
<p>So far we considered predictions for a single set of input parameters. However, to fully harvest the computational power of neural networks, it is often convenient to consider <em>batch</em> predictions for multiple sets of input parameters. These can be easily obtained from <code>cosmopower_NN</code> by feeding the emulator with a <code>dict</code> of <code>np.arrays</code> of parameters. For example, let&rsquo;s create 10 random sets of cosmological parameters:</p>
<div class="highlight"><pre><span></span><code><span class="n">omega_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.01875</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.02625</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">omega_cdm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.64</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.82</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">tau_reio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">n_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.84</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">lnAs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">1.61</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">3.91</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
</code></pre></div>
<p>Now let&rsquo;s collect these 10 sets of cosmological parameters into a <code>dict</code> of <code>np.arrays</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># create a dict of cosmological parameters</span>
<span class="n">batch_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;omega_b&#39;</span><span class="p">:</span> <span class="n">omega_b</span><span class="p">,</span>
                <span class="s1">&#39;omega_cdm&#39;</span><span class="p">:</span> <span class="n">omega_cdm</span><span class="p">,</span>
                <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span>
                <span class="s1">&#39;tau_reio&#39;</span><span class="p">:</span> <span class="n">tau_reio</span><span class="p">,</span>
                <span class="s1">&#39;n_s&#39;</span><span class="p">:</span> <span class="n">n_s</span><span class="p">,</span>
                <span class="s1">&#39;ln10^</span><span class="si">{10}</span><span class="s1">A_s&#39;</span><span class="p">:</span> <span class="n">lnAs</span><span class="p">,</span>
                <span class="p">}</span>
</code></pre></div>
<p>We can now <em>simultaneously</em> obtain predictions for <em>all</em> of the 10 parameter sets. Note that the syntax is unchanged w.r.t. the single-set case! </p>
<div class="highlight"><pre><span></span><code><span class="c1"># predictions (= forward pass thorugh the network) -&gt; 10^predictions</span>
<span class="n">batch_spectra_cosmopower_NN</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">ten_to_predictions_np</span><span class="p">(</span><span class="n">batch_params</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">batch_spectra_cosmopower_NN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">ell_modes</span><span class="o">*</span><span class="p">(</span><span class="n">ell_modes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$\omega_{{\mathrm{{b}}}}$: </span><span class="si">{:1.3f}</span><span class="s1">, $\omega_{{\mathrm{{cdm}}}}$: </span><span class="si">{:1.2f}</span><span class="s1">, $h$: </span><span class="si">{:1.2f}</span><span class="s1">, $</span><span class="se">\\</span><span class="s1">tau$: </span><span class="si">{:1.2f}</span><span class="s1">, $n_s$: </span><span class="si">{:1.2f}</span><span class="s1">, $</span><span class="se">\\</span><span class="s1">mathrm{{ln}} 10^{{10}}A_s$: </span><span class="si">{:1.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;omega_b&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;omega_cdm&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;tau_reio&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;n_s&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;ln10^</span><span class="si">{10}</span><span class="s1">A_s&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">ell_modes</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\ell$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;30&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">frac{\ell(\ell+1)}{2 \pi} C_\ell$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;30&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../output_44_1.png" /></p>
<h1 id="cosmopower_nn-pk-example"><strong><code>cosmopower_NN</code> - <span class="arithmatex">\(P(k)\)</span> example</strong><a class="headerlink" href="#cosmopower_nn-pk-example" title="Permanent link">&para;</a></h1>
<p>As explained above, there is no fundamental difference between the way <code>cosmopower_NN</code> works for CMB and matter power spectra. For this reason here we will simply run the same code cells above, this time for a linear <span class="arithmatex">\(P(k)\)</span> emulator. </p>
<p><strong>Note 1</strong>: the sampled modes here are <span class="arithmatex">\(k\)</span>-modes. </p>
<p><strong>Note 2</strong>: the units are Mpc<span class="arithmatex">\(^{-1}\)</span> for the <span class="arithmatex">\(k\)</span>-modes and Mpc<span class="arithmatex">\(^3\)</span> for <span class="arithmatex">\(P(k)\)</span>.</p>
<p><strong>Note 3</strong>: the redshift <span class="arithmatex">\(z\)</span> is treated as an additional parameter fed to <code>cosmopower_NN</code>. </p>
<div class="highlight"><pre><span></span><code><span class="c1"># load pre-trained NN model: maps cosmological parameters to linear log-P(k)</span>
<span class="n">cp_nn</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">cosmopower_NN</span><span class="p">(</span><span class="n">restore</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                         <span class="n">restore_filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ipynb_path</span><span class="p">,</span> <span class="s1">&#39;../../cosmopower/trained_models/CP_paper/PK/PKLIN_NN&#39;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;emulator parameters: &#39;</span><span class="p">,</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>emulator parameters:  ListWrapper([&#39;omega_b&#39;, &#39;omega_cdm&#39;, &#39;h&#39;, &#39;n_s&#39;, &#39;ln10^{10}A_s&#39;, &#39;z&#39;])
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampled k-modes: &#39;</span><span class="p">,</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;number of k-modes: &#39;</span><span class="p">,</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">n_modes</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hidden layers: &#39;</span><span class="p">,</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>hidden layers:  ListWrapper([512, 512, 512])
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># create a dict of cosmological parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;omega_b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0225</span><span class="p">],</span>
          <span class="s1">&#39;omega_cdm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.113</span><span class="p">],</span>
          <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">],</span>
          <span class="s1">&#39;n_s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.96</span><span class="p">],</span>
          <span class="s1">&#39;ln10^</span><span class="si">{10}</span><span class="s1">A_s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.07</span><span class="p">],</span>
          <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">],</span>
          <span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># predictions (= forward pass thorugh the network)</span>
<span class="n">log_spectrum_cosmopower_NN</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">predictions_np</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># predictions (= forward pass thorugh the network) -&gt; 10^predictions</span>
<span class="n">spectrum_cosmopower_NN</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">ten_to_predictions_np</span><span class="p">(</span><span class="n">params</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<h2 id="comparing-with-class_1"><strong>COMPARING with <code>CLASS</code></strong><a class="headerlink" href="#comparing-with-class_1" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">k_modes</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">modes</span>

<span class="n">cosmo</span> <span class="o">=</span> <span class="n">Class</span><span class="p">()</span>

<span class="c1"># Define your cosmology (what is not specified will be set to CLASS default parameters)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;tCl mPk&#39;</span><span class="p">,</span>
          <span class="s1">&#39;z_max_pk&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
          <span class="s1">&#39;P_k_max_1/Mpc&#39;</span><span class="p">:</span> <span class="mf">10.</span><span class="p">,</span>
          <span class="s1">&#39;nonlinear_min_k_max&#39;</span><span class="p">:</span> <span class="mf">100.</span><span class="p">,</span>
          <span class="s1">&#39;N_ncdm&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s1">&#39;N_eff&#39;</span> <span class="p">:</span> <span class="mf">3.046</span><span class="p">,</span>
          <span class="s1">&#39;omega_b&#39;</span><span class="p">:</span> <span class="mf">0.0225</span><span class="p">,</span>
          <span class="s1">&#39;omega_cdm&#39;</span><span class="p">:</span> <span class="mf">0.113</span><span class="p">,</span>
          <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
          <span class="s1">&#39;n_s&#39;</span><span class="p">:</span> <span class="mf">0.96</span><span class="p">,</span>
          <span class="s1">&#39;ln10^</span><span class="si">{10}</span><span class="s1">A_s&#39;</span><span class="p">:</span> <span class="mf">3.07</span><span class="p">,</span>
          <span class="p">}</span>

<span class="c1"># Set the parameters to the cosmological code</span>
<span class="n">cosmo</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">cosmo</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="n">z</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">spectrum_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cosmo</span><span class="o">.</span><span class="n">pk</span><span class="p">(</span><span class="n">ki</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">ki</span> <span class="ow">in</span> <span class="n">k_modes</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">pred</span> <span class="o">=</span> <span class="n">spectrum_cosmopower_NN</span>
<span class="n">true</span> <span class="o">=</span> <span class="n">spectrum_class</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">k_modes</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CLASS&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">k_modes</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;COSMOPOWER NN&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$k$ [Mpc$^{-1}]$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$P_{\mathrm</span><span class="si">{LIN}</span><span class="s1">}(k) [\mathrm</span><span class="si">{Mpc}</span><span class="s1">^3]$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../output_56_1.png" /></p>
<p>Batch predictions work the same way as in the CMB case:</p>
<div class="highlight"><pre><span></span><code><span class="n">omega_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.01875</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.02625</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">omega_cdm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.64</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.82</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">n_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.84</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">lnAs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">1.61</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">3.91</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># create a dict of cosmological parameters</span>
<span class="n">batch_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;omega_b&#39;</span><span class="p">:</span> <span class="n">omega_b</span><span class="p">,</span>
                <span class="s1">&#39;omega_cdm&#39;</span><span class="p">:</span> <span class="n">omega_cdm</span><span class="p">,</span>
                <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span>
                <span class="s1">&#39;n_s&#39;</span><span class="p">:</span> <span class="n">n_s</span><span class="p">,</span>
                <span class="s1">&#39;ln10^</span><span class="si">{10}</span><span class="s1">A_s&#39;</span><span class="p">:</span> <span class="n">lnAs</span><span class="p">,</span>
                <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span>
               <span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># predictions (= forward pass thorugh the network) -&gt; 10^predictions</span>
<span class="n">batch_spectra_cosmopower_NN</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">ten_to_predictions_np</span><span class="p">(</span><span class="n">batch_params</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">batch_spectra_cosmopower_NN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$\omega_{{\mathrm{{b}}}}$: </span><span class="si">{:1.3f}</span><span class="s1">, $\omega_{{\mathrm{{cdm}}}}$: </span><span class="si">{:1.2f}</span><span class="s1">, $h$: </span><span class="si">{:1.2f}</span><span class="s1">, $n_s$: </span><span class="si">{:1.2f}</span><span class="s1">, $</span><span class="se">\\</span><span class="s1">mathrm{{ln}} 10^{{10}}A_s$: </span><span class="si">{:1.2f}</span><span class="s1">, $z$: </span><span class="si">{:1.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;omega_b&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;omega_cdm&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;n_s&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;ln10^</span><span class="si">{10}</span><span class="s1">A_s&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">batch_params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">k_modes</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$k [\mathrm{{Mpc}}^{{-1}}]$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;30&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$P(k)_{{\mathrm{{LIN}}}} [\mathrm{{Mpc}}^{{3}}]$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;30&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../output_61_1.png" /></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../../../installation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Installation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Installation
            </div>
          </div>
        </a>
      
      
        
        <a href="../../getting_started_with_cosmopower_PCAplusNN/getting_started_with_cosmopower_PCAplusNN/" class="md-footer__link md-footer__link--next" aria-label="Next: PCA+NN emulation" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              PCA+NN emulation
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/alessiospuriomancini/cosmopower" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.8aa65030.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>